

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Conda kapsel tutorial &mdash; Conda   documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="Conda   documentation" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="fa fa-home"> Conda</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="../get-started.html">Get started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro.html">Intro to conda</a></li>
<li class="toctree-l2"><a class="reference internal" href="../download.html">Download conda</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test-drive.html">Test drive</a></li>
<li class="toctree-l2"><a class="reference internal" href="../using/cheatsheet.html">Conda cheat sheet</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../using/index.html">Using conda</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../using/using.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../using/envs.html">Managing environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../py2or3.html">Managing Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../using/pkgs.html">Managing packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../r-with-conda.html">Using R with conda</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mro.html">Using Microsoft R Open</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../building/build.html">Building packages</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../build_tutorials.html">Build tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../building/bpp.html">Building conda packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../building/shared-libraries.html">Using shared libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../custom-channels.html">Custom channels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../signed-packages.html">Signing conda packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bdist_conda.html">Bdist_conda</a></li>
<li class="toctree-l2"><a class="reference internal" href="../building/sample-recipes.html">Sample recipes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../help/help.html">Help &amp; reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../using/cheatsheet.html">Conda cheat sheet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands.html">Command reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help/support.html">Support options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../license.html">Conda license</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../get-involved.html">Get involved</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../get-involved.html#join-conda-email-group">Join conda email group</a></li>
<li class="toctree-l2"><a class="reference internal" href="../get-involved.html#contribute-recipes-to-github">Contribute recipes to GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../get-involved.html#report-a-bug">Report a bug</a></li>
<li class="toctree-l2"><a class="reference internal" href="../get-involved.html#give-us-feedback">Give us feedback</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Conda</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Conda kapsel tutorial</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="https://github.com/conda/conda-docs/edit/master/docs/source/kapsel/index.rst" class="fa fa-github"> Edit on GitHub</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="conda-kapsel-tutorial">
<h1>Conda kapsel tutorial<a class="headerlink" href="#conda-kapsel-tutorial" title="Permalink to this headline">¶</a></h1>
<p>Conda kapsel automates setup steps such as installing the right
packages, downloading files, and configuring passwords so that
anyone who wants to look at your notebooks, Bokeh plots or other
analysis code can type <tt class="docutils literal"><span class="pre">conda</span> <span class="pre">kapsel</span> <span class="pre">run</span></tt> and have it Just
Work(tm).</p>
<p>Even if you never share your project with others, you will find it
more convenient to use <tt class="docutils literal"><span class="pre">conda</span> <span class="pre">kapsel</span></tt> than to manually maintain
an environment with commands such as <tt class="docutils literal"><span class="pre">conda</span> <span class="pre">install</span></tt>.</p>
<p>In this tutorial, you will create a kapsel containing a Bokeh
application, then package it up as a zip file and &#8220;send&#8221; it to an
imaginary colleague. Your colleague will then be able to unpack it
and run it with a single command. You do not need to know Bokeh to
do this tutorial.</p>
<p>This tutorial is for all platforms: Windows, OS X and Linux.</p>
<p>NOTE: You must have <a class="reference external" href="http://conda.pydata.org/docs/install/quick.html">conda installed</a> before
beginning this tutorial.</p>
<div class="section" id="install-conda-kapsel">
<h2>Install conda kapsel<a class="headerlink" href="#install-conda-kapsel" title="Permalink to this headline">¶</a></h2>
<p>Create and activate a conda environment for this tutorial, naming
it &#8220;kapsel-tutorial&#8221;.</p>
<p><strong>On Windows</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda create -n kapsel-tutorial python
activate kapsel-tutorial
</pre></div>
</div>
<p><strong>On OS X or Linux</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda create -n kapsel-tutorial python
source activate kapsel-tutorial
</pre></div>
</div>
<p>Next, use conda to install the keyring package from the
conda-forge channel:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda install -c conda-forge keyring
</pre></div>
</div>
<p>Next, use conda to install conda-kapsel from the conda-kapsel
channel:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda install -c conda-kapsel conda-kapsel
</pre></div>
</div>
<p>Test your installation by running the &#8220;version&#8221; command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda kapsel --version
</pre></div>
</div>
<p>If it installed correctly, kapsel will respond with the version
number.</p>
</div>
<div class="section" id="create-an-empty-project">
<h2>Create an empty project<a class="headerlink" href="#create-an-empty-project" title="Permalink to this headline">¶</a></h2>
<p>We&#8217;ll create a project directory called <tt class="docutils literal"><span class="pre">iris</span></tt>. At the command
prompt, switch to a directory you&#8217;d like to contain the <tt class="docutils literal"><span class="pre">iris</span></tt>
project. To create the <tt class="docutils literal"><span class="pre">iris</span></tt> project directory, type this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda kapsel init --directory iris
</pre></div>
</div>
<p>It will ask you whether to create the <tt class="docutils literal"><span class="pre">iris</span></tt> directory. Type &#8220;y&#8221;
to confirm.  Your command line session will look something like
this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ cd /home/alice/mystuff
$ conda kapsel init --directory iris
Create directory &#39;/home/alice/mystuff/iris&#39;? y
Project configuration is in /home/alice/mystuff/iris/kapsel.yml
</pre></div>
</div>
<p>Optional: You can use your editor now to look through the file
<tt class="docutils literal"><span class="pre">iris/kapsel.yml</span></tt>. We won&#8217;t edit <tt class="docutils literal"><span class="pre">kapsel.yml</span></tt> manually in this
tutorial, but you will see later that the commands we use in this
tutorial will modify it.</p>
<p>Before continuing, change into your new <tt class="docutils literal"><span class="pre">iris</span></tt> directory:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>cd iris
</pre></div>
</div>
</div>
<div class="section" id="get-some-data-to-work-with">
<h2>Get some data to work with<a class="headerlink" href="#get-some-data-to-work-with" title="Permalink to this headline">¶</a></h2>
<p>Often data sets are too large to keep locally, so you may want to
download them on demand. We&#8217;ll use a small data set about iris
flowers to show how download on demand works.</p>
<p>Change into your new <tt class="docutils literal"><span class="pre">iris</span></tt> project directory, then copy and
paste in this code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda kapsel add-download IRIS_CSV https://raw.githubusercontent.com/bokeh/bokeh/f9aa6a8caae8c7c12efd32be95ec7b0216f62203/bokeh/sampledata/iris.csv
</pre></div>
</div>
<p>After clicking &#8220;enter&#8221; <tt class="docutils literal"><span class="pre">conda</span> <span class="pre">kapsel</span></tt> downloads the data
file. You will see a new file <tt class="docutils literal"><span class="pre">iris.csv</span></tt> in your iris
directory. Now if you look at <tt class="docutils literal"><span class="pre">kapsel.yml</span></tt>, you&#8217;ll see a new
entry in the <tt class="docutils literal"><span class="pre">downloads:</span></tt> section.</p>
<p>Here&#8217;s what the command line session looks like:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ cd /home/alice/mystuff/iris
$ conda kapsel add-download IRIS_CSV  https://raw.githubusercontent.com/bokeh/bokeh/f9aa6a8caae8c7c12efd32be95ec7b0216f62203/bokeh/sampledata/iris.csv
File downloaded to /home/alice/mystuff/iris/iris.csv
Added https://raw.githubusercontent.com/bokeh/bokeh/f9aa6a8caae8c7c12efd32be95ec7b0216f62203/bokeh/sampledata/iris.csv to the project file.
</pre></div>
</div>
<p>TIP: The name <tt class="docutils literal"><span class="pre">IRIS_CSV</span></tt> shown on the second line is the name of
an environment variable. We&#8217;ll get to those in a moment.</p>
</div>
<div class="section" id="create-a-command-to-run">
<h2>Create a command to run<a class="headerlink" href="#create-a-command-to-run" title="Permalink to this headline">¶</a></h2>
<p>A project should contain some sort of code, right? Let&#8217;s make a
&#8220;hello world&#8221;.  Create a file <tt class="docutils literal"><span class="pre">hello.py</span></tt> with these contents:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now you could run <tt class="docutils literal"><span class="pre">hello.py</span></tt> with the command <tt class="docutils literal"><span class="pre">python</span>
<span class="pre">hello.py</span></tt>. But that won&#8217;t do any <tt class="docutils literal"><span class="pre">conda</span> <span class="pre">kapsel</span></tt> magic. To be
sure things get set up, add <tt class="docutils literal"><span class="pre">hello.py</span></tt> as a project command,
like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda kapsel add-command hello &quot;python hello.py&quot;
</pre></div>
</div>
<p>It will ask you what kind of command it is; choose <tt class="docutils literal"><span class="pre">C</span></tt> for
command line. The command line session looks like:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ conda kapsel add-command hello &quot;python hello.py&quot;
Is `hello` a (B)okeh app, (N)otebook, or (C)ommand line? C
Added a command &#39;hello&#39; to the project. Run it with `conda kapsel run hello`.
</pre></div>
</div>
<p>Now try <tt class="docutils literal"><span class="pre">conda</span> <span class="pre">kapsel</span> <span class="pre">run</span> <span class="pre">hello</span></tt>. There will be a short delay as
the new dedicated project is created, and then it will print
&#8220;hello&#8221;.</p>
<p>NOTE: Since you have only one command, plain <tt class="docutils literal"><span class="pre">conda</span> <span class="pre">kapsel</span> <span class="pre">run</span></tt>
would work too.</p>
<p>When you run the command the second time, it runs much faster
because the dedicated project is already created.</p>
<p>In your <tt class="docutils literal"><span class="pre">iris</span></tt> directory, you will now see an <tt class="docutils literal"><span class="pre">envs</span></tt>
subdirectory. By default every project has its own packages in its
own sandbox to ensure that projects do not interfere with one
another.</p>
<p>Now if you look at <tt class="docutils literal"><span class="pre">kapsel.yml</span></tt> in your text editor you will see
the <tt class="docutils literal"><span class="pre">hello</span></tt> command in the <tt class="docutils literal"><span class="pre">commands:</span></tt> section.</p>
<p>You can also list all the commands in your project by typing
<tt class="docutils literal"><span class="pre">conda</span> <span class="pre">kapsel</span> <span class="pre">list-commands</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ conda kapsel list-commands
Commands for project: /home/alice/mystuff/iris

Name      Description
====      ===========
hello     python hello.py
</pre></div>
</div>
</div>
<div class="section" id="adding-required-packages">
<h2>Adding required packages<a class="headerlink" href="#adding-required-packages" title="Permalink to this headline">¶</a></h2>
<p>In the next steps, we&#8217;ll need to use some packages that aren&#8217;t in
our <tt class="docutils literal"><span class="pre">iris/envs/default</span></tt> environment yet: Bokeh and Pandas.</p>
<p>In your <tt class="docutils literal"><span class="pre">iris</span></tt> directory, type:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda kapsel add-packages bokeh=0.12 pandas
</pre></div>
</div>
<p>The command line session will look something like:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ conda kapsel add-packages bokeh=0.12 pandas
conda install: Using Anaconda Cloud api site https://api.anaconda.org
Using Conda environment /home/alice/mystuff/iris/envs/default.
Added packages to project file: bokeh=0.12, pandas.
</pre></div>
</div>
<p>If you look at <tt class="docutils literal"><span class="pre">kapsel.yml</span></tt> now, you&#8217;ll see bokeh and pandas
listed under the <tt class="docutils literal"><span class="pre">packages:</span></tt> section. You will also see files
such as <tt class="docutils literal"><span class="pre">envs/default/bin/bokeh</span></tt> since the packages have now
been installed in your project&#8217;s environment.</p>
</div>
<div class="section" id="configure-your-project-with-environment-variables">
<h2>Configure your project with environment variables<a class="headerlink" href="#configure-your-project-with-environment-variables" title="Permalink to this headline">¶</a></h2>
<p>You may have wondered about that string <tt class="docutils literal"><span class="pre">IRIS_CSV</span></tt> when you
first looked in your <tt class="docutils literal"><span class="pre">kapsel.yml</span></tt> file. That&#8217;s the environment
variable that tells your program where <tt class="docutils literal"><span class="pre">iris.csv</span></tt> lives. There
are also some other environment variables that <tt class="docutils literal"><span class="pre">conda</span> <span class="pre">kapsel</span></tt>
sets automatically, such as <tt class="docutils literal"><span class="pre">PROJECT_DIR</span></tt> which locates your
project directory.</p>
<p>You can grab these variables from within your scripts with
Python&#8217;s <tt class="docutils literal"><span class="pre">os.getenv</span></tt> function.</p>
<p>Let&#8217;s make a script that prints out our data. In your text editor,
name the script <tt class="docutils literal"><span class="pre">showdata.py</span></tt> and paste in the following code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">project_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;PROJECT_DIR&quot;</span><span class="p">)</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;CONDA_DEFAULT_ENV&quot;</span><span class="p">)</span>
<span class="n">iris_csv</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;IRIS_CSV&quot;</span><span class="p">)</span>

<span class="n">flowers</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">iris_csv</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">flowers</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;My project directory is {} and my conda environment is {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_dir</span><span class="p">,</span> <span class="n">env</span><span class="p">))</span>
</pre></div>
</div>
<p>Save and close the editor. If you tried to run your new script now
with <tt class="docutils literal"><span class="pre">python</span> <span class="pre">showdata.py</span></tt> it probably wouldn&#8217;t work, because
Pandas might not be installed yet and the environment variables
wouldn&#8217;t be set.</p>
<p>Tell <tt class="docutils literal"><span class="pre">conda</span> <span class="pre">kapsel</span></tt> how to run your new script by adding a new
command called showdata:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda kapsel add-command showdata &#39;python showdata.py&#39;
</pre></div>
</div>
<p>(When prompted, choose &#8220;C&#8221; for &#8220;command line&#8221;.)</p>
<p>Now run that new command at the command prompt:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda kapsel run showdata
</pre></div>
</div>
<p>You will see the data print out, and then the sentence about &#8220;My
project directory is... and my conda environment is...&#8221;.</p>
<p>Good work so far!</p>
</div>
<div class="section" id="custom-variables">
<h2>Custom variables<a class="headerlink" href="#custom-variables" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s say your new command needs a database password, or has
another tunable parameter. You can require (or just allow) users
to configure these before the command runs.</p>
<p>NOTE: Encrypted variables such as passwords are treated
differently from plain variables. Encrypted variable values are
kept in the system keychain, while plain variable values are kept
in the file <tt class="docutils literal"><span class="pre">kapsel-local.yml</span></tt>.</p>
<p>Let&#8217;s try out a plain unencrypted variable first.</p>
<p>Type the command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda kapsel add-variable COLUMN_TO_SHOW
</pre></div>
</div>
<p>In <tt class="docutils literal"><span class="pre">kapsel.yml</span></tt> you now have a variable named <tt class="docutils literal"><span class="pre">COLUMN_TO_SHOW</span></tt>
in the <tt class="docutils literal"><span class="pre">variables:</span></tt> section, and <tt class="docutils literal"><span class="pre">conda</span> <span class="pre">kapsel</span> <span class="pre">list-variables</span></tt>
lists <tt class="docutils literal"><span class="pre">COLUMN_TO_SHOW</span></tt>.</p>
<p>Now modify your script <tt class="docutils literal"><span class="pre">showdata.py</span></tt> to use this new variable:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">project_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;PROJECT_DIR&quot;</span><span class="p">)</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;CONDA_DEFAULT_ENV&quot;</span><span class="p">)</span>
<span class="n">iris_csv</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;IRIS_CSV&quot;</span><span class="p">)</span>
<span class="n">column_to_show</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;COLUMN_TO_SHOW&quot;</span><span class="p">)</span>

<span class="n">flowers</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">iris_csv</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Showing column {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">column_to_show</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">flowers</span><span class="p">[</span><span class="n">column_to_show</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;My project directory is {} and my conda environment is {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_dir</span><span class="p">,</span> <span class="n">env</span><span class="p">))</span>
</pre></div>
</div>
<p>Because there&#8217;s no value yet for <tt class="docutils literal"><span class="pre">COLUMN_TO_SHOW</span></tt>, it will be
mandatory for users to provide one. Try this command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda kapsel run showdata
</pre></div>
</div>
<p>The first time you run this, you will see a prompt asking you to
type in a column name. If you enter a column at the prompt (try
&#8220;sepal_length&#8221;), it will be saved in <tt class="docutils literal"><span class="pre">kapsel-local.yml</span></tt>. Next
time you run it, you won&#8217;t be prompted for a value.</p>
<p>To change the value in <tt class="docutils literal"><span class="pre">kapsel-local.yml</span></tt>, use:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda kapsel set-variable COLUMN_TO_SHOW=petal_length
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">kapsel-local.yml</span></tt> is local to this user and machine, while
<tt class="docutils literal"><span class="pre">kapsel.yml</span></tt> is shared across all users of a project.</p>
<p>You can also set a default value for a variable in <tt class="docutils literal"><span class="pre">kapsel.yml</span></tt>;
if you do this, users are not prompted for a value, but they can
override the default if they want to. Set a default value like
this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda kapsel add-variable --default=sepal_width COLUMN_TO_SHOW
</pre></div>
</div>
<p>Now you should see the default in <tt class="docutils literal"><span class="pre">kapsel.yml</span></tt>.</p>
<p>If you&#8217;ve set the variable in <tt class="docutils literal"><span class="pre">kapsel-local.yml</span></tt>, the default
will be ignored.  You can unset your local override with:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda kapsel unset-variable COLUMN_TO_SHOW
</pre></div>
</div>
<p>The default will then be used when you <tt class="docutils literal"><span class="pre">conda</span> <span class="pre">kapsel</span> <span class="pre">run</span> <span class="pre">showdata</span></tt>.</p>
<p>NOTE: <tt class="docutils literal"><span class="pre">unset-variable</span></tt> removes the variable value, but keeps the
requirement that <tt class="docutils literal"><span class="pre">COLUMN_TO_SHOW</span></tt> must be set.
<tt class="docutils literal"><span class="pre">remove-variable</span></tt> removes the variable requirement from
<tt class="docutils literal"><span class="pre">kapsel.yml</span></tt> so that the project will no longer require a
<tt class="docutils literal"><span class="pre">COLUMN_TO_SHOW</span></tt> value in order to run.</p>
</div>
<div class="section" id="an-encrypted-custom-variable">
<h2>An encrypted custom variable<a class="headerlink" href="#an-encrypted-custom-variable" title="Permalink to this headline">¶</a></h2>
<p>It&#8217;s good practice to use variables for passwords and secrets in
particular.  This way, every user of the project can input their
own password, and it will be kept in their system keychain.</p>
<p>Any variable ending in <tt class="docutils literal"><span class="pre">_PASSWORD</span></tt>, <tt class="docutils literal"><span class="pre">_SECRET</span></tt>, or
<tt class="docutils literal"><span class="pre">_SECRET_KEY</span></tt> is encrypted by default.</p>
<p>To create an encrypted custom variable, type:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda kapsel add-variable DB_PASSWORD
</pre></div>
</div>
<p>In <tt class="docutils literal"><span class="pre">kapsel.yml</span></tt> you now have a <tt class="docutils literal"><span class="pre">DB_PASSWORD</span></tt> in the
<tt class="docutils literal"><span class="pre">variables:</span></tt> section, and <tt class="docutils literal"><span class="pre">conda</span> <span class="pre">kapsel</span> <span class="pre">list-variables</span></tt> lists
<tt class="docutils literal"><span class="pre">DB_PASSWORD</span></tt>.</p>
<p>From here, things work just like the <tt class="docutils literal"><span class="pre">COLUMN_TO_SHOW</span></tt> example
above, except that the value of <tt class="docutils literal"><span class="pre">DB_PASSWORD</span></tt> is saved in the
system keychain rather than in <tt class="docutils literal"><span class="pre">kapsel-local.yml</span></tt>.</p>
<p>Try for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda kapsel run showdata
</pre></div>
</div>
<p>This will prompt you for a value the first time, and then save it
in the keychain and use it from there on the second run.  You can
also use <tt class="docutils literal"><span class="pre">conda</span> <span class="pre">kapsel</span> <span class="pre">set-variable</span> <span class="pre">DB_PASSWORD=whatever</span></tt>,
<tt class="docutils literal"><span class="pre">conda</span> <span class="pre">kapsel</span> <span class="pre">unset-variable</span> <span class="pre">DB_PASSWORD</span></tt>, and so on.</p>
<p>Because this Iris example does not need a database password, we&#8217;ll
now remove it. Type:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda kapsel remove-variable DB_PASSWORD
</pre></div>
</div>
</div>
<div class="section" id="creating-a-bokeh-app">
<h2>Creating a Bokeh app<a class="headerlink" href="#creating-a-bokeh-app" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s plot that flower data!</p>
<p>Inside your <tt class="docutils literal"><span class="pre">iris</span></tt> project directory, create a new directory
<tt class="docutils literal"><span class="pre">iris_plot</span></tt>, and in it save a new file named``main.py`` with
these contents:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="n">Figure</span>
<span class="kn">from</span> <span class="nn">bokeh.io</span> <span class="kn">import</span> <span class="n">curdoc</span>

<span class="n">iris_csv</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;IRIS_CSV&quot;</span><span class="p">)</span>

<span class="n">flowers</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">iris_csv</span><span class="p">)</span>

<span class="n">colormap</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;setosa&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;versicolor&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;virginica&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">}</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">colormap</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">flowers</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]]</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Iris Morphology&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Petal Length&#39;</span>
<span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Petal Width&#39;</span>

<span class="n">p</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">flowers</span><span class="p">[</span><span class="s2">&quot;petal_length&quot;</span><span class="p">],</span> <span class="n">flowers</span><span class="p">[</span><span class="s2">&quot;petal_width&quot;</span><span class="p">],</span>
         <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">curdoc</span><span class="p">()</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Iris Example&quot;</span>
<span class="n">curdoc</span><span class="p">()</span><span class="o">.</span><span class="n">add_root</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>You should now have a file <tt class="docutils literal"><span class="pre">iris_plot/main.py</span></tt> inside the
project.  The <tt class="docutils literal"><span class="pre">iris_plot</span></tt> directory is a simple Bokeh app. (If
you aren&#8217;t familiar with Bokeh you can learn more from the <a class="reference external" href="http://bokeh.pydata.org/en/latest/">Bokeh
documentation</a>.)</p>
<p>To tell <tt class="docutils literal"><span class="pre">conda</span> <span class="pre">kapsel</span></tt> about the Bokeh app, be sure you are in
the directory &#8220;iris&#8221; and type:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda kapsel add-command plot iris_plot
</pre></div>
</div>
<p>When prompted, type <tt class="docutils literal"><span class="pre">B</span></tt> for Bokeh app. The command line session
looks like:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ conda kapsel add-command plot iris_plot
Is `plot` a (B)okeh app, (N)otebook, or (C)ommand line? B
Added a command &#39;plot&#39; to the project. Run it with `conda kapsel run plot`.
</pre></div>
</div>
<p>NOTE: We use the app directory path, not the script path
<tt class="docutils literal"><span class="pre">iris_plot/main.py</span></tt>, to refer to a Bokeh app. Bokeh looks for
the file <tt class="docutils literal"><span class="pre">main.py</span></tt> by convention.</p>
<p>To see your Bokeh plot, run this command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda kapsel run plot --show
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">--show</span></tt> gets passed to the <tt class="docutils literal"><span class="pre">bokeh</span> <span class="pre">serve</span></tt> command, and tells
Bokeh to open a browser window. Other options for <tt class="docutils literal"><span class="pre">bokeh</span> <span class="pre">serve</span></tt>
can be appended to the <tt class="docutils literal"><span class="pre">conda</span> <span class="pre">kapsel</span> <span class="pre">run</span></tt> command line as well,
if you like.</p>
<p>A browser window opens, displaying the Iris plot. Success!</p>
</div>
<div class="section" id="clean-and-reproduce">
<h2>Clean and reproduce<a class="headerlink" href="#clean-and-reproduce" title="Permalink to this headline">¶</a></h2>
<p>You&#8217;ve left a trail of breadcrumbs in <tt class="docutils literal"><span class="pre">kapsel.yml</span></tt> describing
how to reproduce your project. Look around in your <tt class="docutils literal"><span class="pre">iris</span></tt>
directory and you&#8217;ll see you have <tt class="docutils literal"><span class="pre">envs/default</span></tt> and
<tt class="docutils literal"><span class="pre">iris.csv</span></tt>, which you didn&#8217;t create manually. Let&#8217;s get rid of
the unnecessary stuff.</p>
<p>Type:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda kapsel clean
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">iris.csv</span></tt> and <tt class="docutils literal"><span class="pre">envs/default</span></tt> should now be gone.</p>
<p>Run one of your commands again, and they&#8217;ll come back. Type:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda kapsel run showdata
</pre></div>
</div>
<p>You should have <tt class="docutils literal"><span class="pre">iris.csv</span></tt> and <tt class="docutils literal"><span class="pre">envs/default</span></tt> back as they
were before.</p>
<p>You could also redo the setup steps without running a
command. Clean again:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda kapsel clean
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">iris.csv</span></tt> and <tt class="docutils literal"><span class="pre">envs/default</span></tt> should be gone again. Then re-prepare the project:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda kapsel prepare
</pre></div>
</div>
<p>You should have <tt class="docutils literal"><span class="pre">iris.csv</span></tt> and <tt class="docutils literal"><span class="pre">envs/default</span></tt> back again, but
this time without running a command.</p>
</div>
<div class="section" id="zip-it-up-for-a-colleague">
<h2>Zip it up for a colleague<a class="headerlink" href="#zip-it-up-for-a-colleague" title="Permalink to this headline">¶</a></h2>
<p>To share this project with a colleague, you likely want to put it
in a zip file.  You won&#8217;t want to include <tt class="docutils literal"><span class="pre">envs/default</span></tt>,
because conda environments are large and don&#8217;t work if moved
between machines. If <tt class="docutils literal"><span class="pre">iris.csv</span></tt> were a larger file, you might
not want to include that either. The <tt class="docutils literal"><span class="pre">conda</span> <span class="pre">kapsel</span> <span class="pre">archive</span></tt>
command automatically omits the files it can reproduce
automatically.</p>
<p>Type:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>conda kapsel archive iris.zip
</pre></div>
</div>
<p>You will now have a file <tt class="docutils literal"><span class="pre">iris.zip</span></tt>. If you list the files in
the zip, you&#8217;ll see that the automatically-generated ones aren&#8217;t
in there:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ unzip -l iris.zip
Archive:  iris.zip
  Length      Date    Time    Name
---------  ---------- -----   ----
       16  06-10-2016 10:04   iris/hello.py
      281  06-10-2016 10:22   iris/showdata.py
      222  06-10-2016 09:46   iris/.kapselignore
     4927  06-10-2016 10:31   iris/kapsel.yml
      557  06-10-2016 10:33   iris/iris_plot/main.py
---------                     -------
     6003                     5 files
</pre></div>
</div>
<p>NOTE: There&#8217;s a <tt class="docutils literal"><span class="pre">.kapselignore</span></tt> file you can use to manually
exclude anything you don&#8217;t want in your archives.</p>
<p>NOTE: <tt class="docutils literal"><span class="pre">conda</span> <span class="pre">kapsel</span></tt> also supports creating <tt class="docutils literal"><span class="pre">.tar.gz</span></tt> and
<tt class="docutils literal"><span class="pre">.tar.bz2</span></tt> archives. The archive format will match the filename
you provide.</p>
<p>When your colleague unzips the archive, they can list the commands
in it:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ conda kapsel list-commands
Commands for project: /home/bob/projects/iris

Name      Description
====      ===========
hello     python hello.py
plot      Bokeh app iris_plot
showdata  python showdata.py
</pre></div>
</div>
<p>Then your colleague can type <tt class="docutils literal"><span class="pre">conda</span> <span class="pre">kapsel</span> <span class="pre">run</span> <span class="pre">showdata</span></tt> (for
example), and <tt class="docutils literal"><span class="pre">conda</span> <span class="pre">kapsel</span></tt> will download the data, install
needed packages, and run the command.</p>
</div>
<div class="section" id="next-steps">
<h2>Next steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h2>
<p>There&#8217;s much more that <tt class="docutils literal"><span class="pre">conda</span> <span class="pre">kapsel</span></tt> can do.</p>
<blockquote>
<div><ul class="simple">
<li>It can automatically start processes that your commands depend
on. Right now it only supports starting Redis, for
demonstration purposes. Use the <tt class="docutils literal"><span class="pre">conda</span> <span class="pre">kapsel</span> <span class="pre">add-service</span>
<span class="pre">redis</span></tt> command to play with this. More kinds of service will
be supported soon! Let us know if there are particular ones
you&#8217;d find useful.</li>
<li>You can have multiple conda environment specifications in your
project, which is useful if some of your commands use a
different version of Python or otherwise have distinct
dependencies. <tt class="docutils literal"><span class="pre">conda</span> <span class="pre">kapsel</span> <span class="pre">add-env-spec</span></tt> adds these
additional environment specs.</li>
<li>Commands can be ipython notebooks. If you create a notebook in
your project directory it will automatically be listed in
<tt class="docutils literal"><span class="pre">conda</span> <span class="pre">kapsel</span> <span class="pre">list-commands</span></tt>.</li>
</ul>
</div></blockquote>
</div>
</div>


          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Continuum Analytics.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:' ',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-27761864-11', 'auto');
  ga('send', 'pageview');

</script>


</body>
</html>